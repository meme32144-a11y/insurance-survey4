<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ค้นพบพิมพ์เขียวแห่งชีวิตของคุณ | Life Blueprint Survey</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4A69BD; /* Royal Blue */
            --secondary-color: #6A89CC; /* Light Blue */
            --accent-color: #F6B93B; /* Yellow */
            --danger-color: #e74c3c;
            --bg-color: #F7F9FC;
            --text-color: #333D49;
            --light-gray: #EAECEF;
            --white: #FFFFFF;
            --border-radius-lg: 16px;
            --border-radius-md: 12px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
            --transition: all 0.3s ease-in-out;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.8;
        }

        .main-container {
            max-width: 750px;
            margin: 2rem auto;
            padding: 1rem;
        }

        .survey-card {
            background: var(--white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            overflow: hidden;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.6s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .survey-chapter {
            display: none;
            padding: 2rem 2.5rem;
        }

        .survey-chapter.active { 
            display: block; 
            animation: slideIn 0.5s forwards;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(15px); }
            to { opacity: 1; transform: translateX(0); }
        }

        h2.chapter-title {
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }
        p.chapter-subtitle {
            margin-bottom: 2rem;
            color: #6c757d;
        }
        
        .question-group { 
            margin-bottom: 2.5rem; 
            padding: 1rem;
            border-radius: var(--border-radius-md);
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .question-group.invalid {
            animation: shake 0.5s;
            border-color: var(--danger-color);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .form-label { font-weight: 600; font-size: 1.1rem; margin-bottom: 1rem; }

        /* Custom Input Styles */
        .image-card-selector { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .image-card { border: 2px solid var(--light-gray); border-radius: var(--border-radius-md); padding: 1rem; text-align: center; cursor: pointer; transition: var(--transition); position: relative; }
        .image-card img { width: 100%; height: 120px; object-fit: cover; border-radius: 8px; margin-bottom: 0.5rem; }
        .image-card .form-check-input { position: absolute; top: 10px; right: 10px; width: 1.5em; height: 1.5em; }
        .image-card:hover { transform: translateY(-5px); border-color: var(--secondary-color); }
        input[type="radio"]:checked + .image-card { border-color: var(--primary-color); background-color: #F7F9FC; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        .choice-selector .form-check { margin-bottom: 0.5rem; }
        .choice-selector .form-check-input { margin-top: 0.4em; }

        .slider-container { text-align: center; }
        .slider-container input[type="range"] { width: 100%; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.9rem; color: #888; margin-top: 0.5rem; }
        
        .icon-checkbox-group .form-check { display: flex; align-items: center; margin-bottom: 0.75rem; }
        .icon-checkbox-group .icon { margin-right: 10px; color: var(--primary-color); width: 20px; text-align: center; }
        
        .info-table {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: var(--border-radius-md);
            font-size: 0.9rem;
        }
        .info-table th, .info-table td {
            text-align: center;
        }

        /* Navigation & Progress */
        .progress-container { padding: 1.5rem 2.5rem 0.5rem; }
        .progress { height: 8px; border-radius: 4px; background-color: var(--light-gray); }
        .progress-bar { background: linear-gradient(90deg, var(--secondary-color), var(--primary-color)); }
        #chapterCounter { font-size: 0.9rem; color: #6c757d; }

        .navigation-footer { padding: 1.5rem 2.5rem; background-color: #F7F9FC; border-top: 1px solid var(--light-gray); }
        .btn-custom { padding: 0.8rem 1.8rem; font-weight: 600; border-radius: var(--border-radius-md); transition: var(--transition); border: none; }
        .btn-next { background-color: var(--primary-color); color: var(--white); }
        .btn-next:hover { background-color: #3b5699; }
        .btn-prev { background-color: var(--light-gray); color: var(--text-color); }

        /* Blueprint/Report Section */
        #blueprint-container, #final-blueprint-container { text-align: center; padding: 3rem 1.5rem; }
        .gemini-report h3 { color: var(--primary-color); font-weight: bold; margin-top: 2rem; }
        .gemini-report h4 { font-weight: 600; margin-top: 1.5rem; }
        .gemini-report .report-section { background: var(--white); padding: 1.5rem; border-radius: var(--border-radius-md); margin-bottom: 1rem; text-align: left; border-left: 5px solid; }
        
        #deep-dive-cta {
            background-color: #e9ecef;
            padding: 2rem;
            border-radius: var(--border-radius-md);
            text-align: center;
        }
        
        /* CTA Section */
        #final-cta-section { background-color: var(--light-gray); padding: 2rem; border-radius: var(--border-radius-md); margin-top: 2rem; }
        #final-cta-section h4 { font-weight: 600; margin-bottom: 1.5rem; }
        .cta-btn { width: 100%; text-align: left; padding: 1rem; margin-bottom: 0.75rem; background-color: var(--white); border-radius: var(--border-radius-md); }
        .cta-btn .cta-title { font-weight: 600; }
        .cta-btn .cta-desc { font-size: 0.9rem; }

    </style>
</head>
<body>

    <div class="main-container">
        <div class="survey-card">

            <!-- Welcome Screen (Chapter 0) -->
            <div id="chapter-0" class="survey-chapter active text-center">
                <i class="fas fa-map-signs fa-3x mb-4" style="color: var(--primary-color);"></i>
                <h2 class="chapter-title">เริ่มต้นการเดินทางสู่ "พิมพ์เขียวแห่งชีวิต"</h2>
                <p class="text-muted">มาใช้เวลาสั้นๆ เพื่อสำรวจเส้นทางชีวิตของคุณ ทั้งในปัจจุบันและอนาคตที่วาดฝันไว้ แบบสอบถามนี้จะช่วยให้คุณมองเห็นภาพรวมและเตรียมพร้อมสำหรับทุกก้าวต่อไป</p>
                <button id="startButton" class="btn btn-custom btn-next mt-4">เริ่มต้นกันเลย!</button>
            </div>

            <form id="surveyForm" novalidate>
                <!-- Progress Bar (shown after start) -->
                <div id="progress-wrapper" class="progress-container d-none">
                    <div class="d-flex justify-content-between mb-1">
                        <span id="chapterName" class="fw-bold" style="color: var(--primary-color);"></span>
                        <span id="chapterCounter"></span>
                    </div>
                    <div class="progress">
                        <div id="progressBar" class="progress-bar" role="progressbar"></div>
                    </div>
                </div>

                <!-- Chapter 1: Your Current Snapshot -->
                <div id="chapter-1" class="survey-chapter" data-name="ภาพร่างปัจจุบัน">
                    <h2 class="chapter-title">Chapter 1: ภาพร่างปัจจุบันของคุณ</h2>
                    <p class="chapter-subtitle">มาเริ่มทำความเข้าใจไลฟ์สไตล์และภาพรวมของคุณกันก่อน</p>
                    <div class="question-group">
                        <label class="form-label">1. ไลฟ์สไตล์ที่ใกล้เคียงกับคุณที่สุดในตอนนี้คือ?</label>
                        <div class="image-card-selector">
                            <div><input type="radio" class="form-check-input" name="lifestyle" value="นักรบออฟฟิศ" id="lifestyle1" required><label for="lifestyle1" class="image-card"><img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?q=80&w=400&auto=format&fit=crop" alt="Office Worker"><span>นักรบออฟฟิศ</span></label></div>
                            <div><input type="radio" class="form-check-input" name="lifestyle" value="ฟรีแลนซ์/สายชิล" id="lifestyle2"><label for="lifestyle2" class="image-card"><img src="https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=400&auto=format&fit=crop" alt="Freelancer"><span>ฟรีแลนซ์/สายชิล</span></label></div>
                            <div><input type="radio" class="form-check-input" name="lifestyle" value="เจ้าของธุรกิจ" id="lifestyle3"><label for="lifestyle3" class="image-card"><img src="https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=400&auto=format&fit=crop" alt="Business Owner"><span>เจ้าของธุรกิจ</span></label></div>
                            <div><input type="radio" class="form-check-input" name="lifestyle" value="คุณพ่อ/คุณแม่ฟูลไทม์" id="lifestyle4"><label for="lifestyle4" class="image-card"><img src="https://i.ibb.co/nMDpBcdj/family-showcasing-their-home.jpg?q=80&w=400&auto=format&fit=crop" alt="Full-time Parent"><span>คุณพ่อ/คุณแม่</span></label></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label for="work_life_balance" class="form-label">2. คุณให้คะแนน Work-Life Balance ของตัวเองเท่าไหร่?</label>
                        <div class="slider-container">
                             <div class="d-flex justify-content-center align-items-center mb-2">
                                 <span class="fw-bold fs-4 me-3" style="color: var(--primary-color);" id="wlb-value-display">5</span>
                             </div>
                            <input type="range" class="form-range" id="work_life_balance" name="work_life_balance" min="0" max="10" step="1" value="5">
                            <div class="slider-labels"><span>ต้องการกาแฟด่วน!</span><span>สบายๆ ชิลๆ</span></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter 2: Your Inner Circle -->
                <div id="chapter-2" class="survey-chapter" data-name="คนสำคัญในชีวิต">
                    <h2 class="chapter-title">Chapter 2: คนสำคัญในชีวิตของคุณ</h2>
                    <p class="chapter-subtitle">ใครคือคนที่คุณห่วงใยและอยากดูแลให้ดีที่สุด</p>
                    <div class="question-group">
                         <label class="form-label">1. ใครคือคนสำคัญที่อยู่ในความดูแลของคุณ?</label>
                         <div class="icon-checkbox-group">
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="dependents" value="ตัวเราเองในอนาคต" id="dep1"><label class="form-check-label" for="dep1"><i class="fas fa-user-clock icon"></i>ตัวเราเองในอนาคต</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="dependents" value="คู่สมรส" id="dep2"><label class="form-check-label" for="dep2"><i class="fas fa-heart icon"></i>คู่สมรส</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="dependents" value="ลูก" id="dep3"><label class="form-check-label" for="dep3"><i class="fas fa-child icon"></i>ลูก</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="dependents" value="คุณพ่อคุณแม่" id="dep4"><label class="form-check-label" for="dep4"><i class="fas fa-user-friends icon"></i>คุณพ่อคุณแม่</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="dependents" value="ไม่มีภาระดูแลใคร" id="dep5"><label class="form-check-label" for="dep5"><i class="fas fa-coffee icon"></i>ยังโสด/ไม่มีภาระ</label></div>
                         </div>
                    </div>
                    <!-- Hidden questions for children -->
                    <div id="children_questions" class="question-group d-none">
                         <label class="form-label">ข้อมูลเกี่ยวกับบุตร</label>
                         <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="children_count" class="form-label-sm">จำนวนบุตร (คน)</label>
                                <input type="number" class="form-control" name="children_count" id="children_count" min="1" placeholder="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="children_ages" class="form-label-sm">อายุของบุตร (เช่น 5, 10)</label>
                                <input type="text" class="form-control" name="children_ages" id="children_ages" placeholder="5, 10">
                            </div>
                         </div>
                    </div>
                    <div class="question-group">
                        <label for="legacy" class="form-label">2. คุณอยากมอบอะไรเป็นมรดกให้คนข้างหลัง (นอกเหนือจากเงิน)?</label>
                        <textarea class="form-control" name="legacy" id="legacy" rows="3" placeholder="เช่น ความรู้, ธุรกิจครอบครัว, ความมั่นคง..."></textarea>
                    </div>
                </div>

                <!-- Chapter 3: Your Future Goals -->
                <div id="chapter-3" class="survey-chapter" data-name="เป้าหมายในอนาคต">
                    <h2 class="chapter-title">Chapter 3: ภาพฝันและเป้าหมายในอนาคต</h2>
                    <p class="chapter-subtitle">มาดูเป้าหมายที่คุณอยากไปให้ถึงกัน</p>
                    <div class="question-group">
                        <label class="form-label">1. อีก 10 ปีข้างหน้า คุณอยากเห็นตัวเองอยู่ที่ไหน?</label>
                        <div class="image-card-selector">
                              <div><input type="radio" class="form-check-input" name="ten_year_vision" value="มีบ้านในฝัน" id="vision1" required><label for="vision1" class="image-card"><img src="https://images.unsplash.com/photo-1568605114967-8130f3a36994?q=80&w=400&auto=format&fit=crop" alt="Dream House"><span>มีบ้านในฝัน</span></label></div>
                              <div><input type="radio" class="form-check-input" name="ten_year_vision" value="ท่องเที่ยวรอบโลก" id="vision2"><label for="vision2" class="image-card"><img src="https://images.unsplash.com/photo-1503220317375-aaad61436b1b?q=80&w=400&auto=format&fit=crop" alt="Travel"><span>ท่องเที่ยวรอบโลก</span></label></div>
                              <div><input type="radio" class="form-check-input" name="ten_year_vision" value="เป็นเจ้าของธุรกิจ" id="vision3"><label for="vision3" class="image-card"><img src="https://images.unsplash.com/photo-1522202176988-66273c2fd55f?q=80&w=400&auto=format&fit=crop" alt="Business"><span>เป็นเจ้าของธุรกิจ</span></label></div>
                              <div><input type="radio" class="form-check-input" name="ten_year_vision" value="เกษียณอย่างมีความสุข" id="vision4"><label for="vision4" class="image-card"><img src="https://images.unsplash.com/photo-1543269865-cbf427effbad?q=80&w=400&auto=format&fit=crop" alt="Retirement"><span>เกษียณอย่างมีความสุข</span></label></div>
                        </div>
                    </div>
                    <div class="question-group">
                        <label class="form-label">2. หากมีเงินก้อนหนึ่ง คุณจะนำไปทำอะไรเป็นอย่างแรก?</label>
                        <div class="choice-selector">
                           <div class="form-check"><input class="form-check-input" type="radio" name="lump_sum_action" id="lsa1" value="ลงทุน" required><label class="form-check-label" for="lsa1">ลงทุนให้งอกเงย</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="lump_sum_action" id="lsa2" value="ปิดหนี้"><label class="form-check-label" for="lsa2">ปิดหนี้สิน</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="lump_sum_action" id="lsa3" value="ให้รางวัลชีวิต"><label class="form-check-label" for="lsa3">ให้รางวัลชีวิต</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="lump_sum_action" id="lsa4" value="เก็บสำรองฉุกเฉิน"><label class="form-check-label" for="lsa4">เก็บเป็นเงินสำรองฉุกเฉิน</label></div>
                        </div>
                    </div>
                </div>

                <!-- Chapter 4: Navigating Life's 'What Ifs' -->
                <div id="chapter-4" class="survey-chapter" data-name="รับมือเรื่องไม่คาดฝัน">
                    <h2 class="chapter-title">Chapter 4: เตรียมพร้อมรับมือเรื่องไม่คาดฝัน</h2>
                    <p class="chapter-subtitle">ลองจินตนาการถึงสถานการณ์ที่อาจเกิดขึ้น</p>
                    <div class="question-group">
                         <label class="form-label">1. หากพรุ่งนี้ต้องเข้ารักษาตัวในโรงพยาบาล สิ่งที่คุณกังวลที่สุดคืออะไร?</label>
                         <div class="icon-checkbox-group">
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="hospital_worry" value="ค่ารักษาพยาบาล" id="hw1"><label class="form-check-label" for="hw1"><i class="fas fa-file-invoice-dollar icon"></i>ค่ารักษาพยาบาล</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="hospital_worry" value="ขาดรายได้" id="hw2"><label class="form-check-label" for="hw2"><i class="fas fa-briefcase-medical icon"></i>ขาดรายได้ช่วงที่พักฟื้น</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="hospital_worry" value="ไม่มีคนดูแลครอบครัว" id="hw3"><label class="form-check-label" for="hw3"><i class="fas fa-users-slash icon"></i>ไม่มีคนดูแลครอบครัว</label></div>
                         </div>
                    </div>
                    <div class="question-group">
                        <label for="emergency_fund" class="form-label">2. คุณมีเงินสำรองฉุกเฉินเพียงพอสำหรับค่าใช้จ่ายกี่เดือน?</label>
                        <div class="slider-container">
                            <div class="d-flex justify-content-center align-items-center mb-2">
                                <span class="fw-bold fs-4 me-2" style="color: var(--primary-color);" id="ef-value-display">3</span>
                                <span>เดือน</span>
                            </div>
                            <input type="range" class="form-range" id="emergency_fund" name="emergency_fund" min="0" max="12" step="1" value="3">
                            <div class="slider-labels"><span>0 เดือน</span><span>12+ เดือน</span></div>
                        </div>
                    </div>
                </div>
                
                <!-- Chapter 5: Initial Blueprint Result Screen (MOVED HERE) -->
                <div id="chapter-5" class="survey-chapter" data-name="พิมพ์เขียวฉบับร่าง">
                    <div id="blueprint-container">
                        <div id="loading-spinner">
                            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3">กำลังสร้างพิมพ์เขียวฉบับร่างสำหรับคุณ...</p>
                        </div>
                        <div id="gemini-report" class="d-none gemini-report">
                            <!-- Gemini AI Report will be injected here -->
                        </div>
                    </div>
                    
                    <div id="deep-dive-cta" class="d-none mt-4">
                         <h4 class="fw-bold">คุณมาได้ครึ่งทางแล้ว!</h4>
                         <p class="text-muted">ข้อมูลเบื้องต้นของคุณช่วยให้เราเห็นภาพรวมที่ยอดเยี่ยม อยากลงลึกในรายละเอียดเพื่อสร้าง "พิมพ์เขียวฉบับสมบูรณ์" ที่ออกแบบมาเพื่อคุณโดยเฉพาะหรือไม่?</p>
                         <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
                             <button id="continueButton" type="button" class="btn btn-primary btn-lg px-4 gap-3">ไปต่อเลย!</button>
                             <button id="stopButton" type="button" class="btn btn-outline-secondary btn-lg px-4">ขอรับข้อมูลเท่านี้ก่อน</button>
                         </div>
                    </div>
                </div>

                <!-- Chapter 6: Your Financial Foundation -->
                <div id="chapter-6" class="survey-chapter" data-name="เจาะลึกด้านการเงิน">
                     <h2 class="chapter-title">Chapter 5: เจาะลึกด้านการเงิน</h2>
                     <p class="chapter-subtitle">ข้อมูลส่วนนี้จะช่วยให้เราวางแผนได้แม่นยำยิ่งขึ้น</p>
                     <div class="question-group">
                         <label class="form-label">1. รายได้หลักต่อเดือน (หลังหักภาษี) อยู่ในช่วงใด?</label>
                          <div class="choice-selector">
                             <div class="form-check"><input class="form-check-input" type="radio" name="income_range" id="ir1" value="ต่ำกว่า 25,000 บาท" required><label class="form-check-label" for="ir1">ต่ำกว่า 25,000 บาท</label></div>
                             <div class="form-check"><input class="form-check-input" type="radio" name="income_range" id="ir2" value="25,001 - 50,000 บาท"><label class="form-check-label" for="ir2">25,001 - 50,000 บาท</label></div>
                             <div class="form-check"><input class="form-check-input" type="radio" name="income_range" id="ir3" value="50,001 - 80,000 บาท"><label class="form-check-label" for="ir3">50,001 - 80,000 บาท</label></div>
                             <div class="form-check"><input class="form-check-input" type="radio" name="income_range" id="ir4" value="80,001 - 150,000 บาท"><label class="form-check-label" for="ir4">80,001 - 150,000 บาท</label></div>
                             <div class="form-check"><input class="form-check-input" type="radio" name="income_range" id="ir5" value="มากกว่า 150,000 บาท"><label class="form-check-label" for="ir5">มากกว่า 150,000 บาท</label></div>
                          </div>
                     </div>
                     <div class="question-group">
                         <label class="form-label">2. คุณสะดวกที่จะแบ่งเงินมาออม "เพื่อเป้าหมายในอนาคต" เดือนละเท่าไหร่?</label>
                         <div class="choice-selector">
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp1" value="น้อยกว่า 3,000 บาท" required><label class="form-check-label" for="sp1">น้อยกว่า 3,000 บาท</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp2" value="3,001 - 7,000 บาท"><label class="form-check-label" for="sp2">3,001 - 7,000 บาท</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp3" value="7,001 - 15,000 บาท"><label class="form-check-label" for="sp3">7,001 - 15,000 บาท</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp4" value="15,001 - 25,000 บาท"><label class="form-check-label" for="sp4">15,001 - 25,000 บาท</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp5" value="มากกว่า 25,000 บาท"><label class="form-check-label" for="sp5">มากกว่า 25,000 บาท</label></div>
                            <div class="form-check"><input class="form-check-input" type="radio" name="saving_potential" id="sp6" value="ยังไม่แน่ใจ"><label class="form-check-label" for="sp6">ยังไม่แน่ใจ อยากปรึกษาก่อน</label></div>
                         </div>
                     </div>
                     <div class="question-group">
                         <label class="form-label">3. โปรดจัดลำดับความสำคัญในชีวิตของคุณ (ลากเพื่อจัดลำดับ)</label>
                         <ul id="sortable-priorities" class="list-group">
                             <li class="list-group-item">การมีเงินพอใช้สุขสบายหลังเกษียณ</li>
                             <li class="list-group-item">การสร้างอนาคตและการศึกษาที่ดีที่สุดให้ลูก</li>
                             <li class="list-group-item">การดูแลสุขภาพของตัวเองและครอบครัวอย่างดีที่สุด</li>
                             <li class="list-group-item">การดูแลคุณพ่อคุณแม่ให้สุขสบาย</li>
                             <li class="list-group-item">การมีอิสรภาพทางการเงินก่อนอายุที่กำหนด</li>
                         </ul>
                         <input type="hidden" name="priorities_order" id="priorities_order">
                     </div>
                </div>

                <!-- Chapter 7: Your Health & Well-being -->
                <div id="chapter-7" class="survey-chapter" data-name="สุขภาพและความเสี่ยง">
                    <h2 class="chapter-title">Chapter 6: สุขภาพและความเสี่ยงรอบตัว</h2>
                    <p class="chapter-subtitle">สุขภาพที่ดีคือรากฐานสำคัญของความสุข</p>
                    <div class="question-group">
                        <label class="form-label">1. สุขภาพโดยรวมของคุณในปัจจุบันเป็นอย่างไร?</label>
                        <div class="choice-selector">
                           <div class="form-check"><input class="form-check-input" type="radio" name="health_status" id="hs1" value="แข็งแรงดีมาก" required><label class="form-check-label" for="hs1">แข็งแรงดีมาก ไม่ค่อยเจ็บป่วย</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="health_status" id="hs2" value="แข็งแรงดี มีป่วยเล็กน้อย"><label class="form-check-label" for="hs2">แข็งแรงดี มีป่วยเล็กน้อยตามฤดูกาล</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="health_status" id="hs3" value="มีโรคประจำตัวที่ควบคุมได้"><label class="form-check-label" for="hs3">มีโรคประจำตัวที่ควบคุมได้</label></div>
                           <div class="form-check"><input class="form-check-input" type="radio" name="health_status" id="hs4" value="มีปัญหาสุขภาพต้องพบแพทย์ประจำ"><label class="form-check-label" for="hs4">มีปัญหาสุขภาพที่ต้องพบแพทย์เป็นประจำ</label></div>
                        </div>
                    </div>
                     <div class="question-group">
                         <label class="form-label">2. คนในครอบครัวสายตรง (ปู่ย่าตายาย, พ่อแม่, พี่น้อง) มีประวัติเจ็บป่วยด้วยโรคเหล่านี้หรือไม่?</label>
                         <div class="icon-checkbox-group">
                            <div class="form-check"><input class="form-check-input" type="checkbox" name="family_history" value="ไม่มี" id="fh1"><label class="form-check-label" for="fh1">ไม่มี</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" name="family_history" value="โรคมะเร็ง" id="fh2"><label class="form-check-label" for="fh2">โรคมะเร็ง</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" name="family_history" value="โรคหัวใจ" id="fh3"><label class="form-check-label" for="fh3">โรคหัวใจและหลอดเลือด</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" name="family_history" value="โรคเบาหวาน/ความดัน" id="fh4"><label class="form-check-label" for="fh4">โรคเบาหวาน / ความดันโลหิตสูง</label></div>
                            <div class="form-check"><input class="form-check-input" type="checkbox" name="family_history" value="อื่นๆ" id="fh5"><label class="form-check-label" for="fh5">โรคร้ายแรงอื่นๆ</label></div>
                         </div>
                     </div>
                </div>

                <!-- Chapter 8: Your Current Safety Net -->
                <div id="chapter-8" class="survey-chapter" data-name="ตาข่ายความปลอดภัย">
                    <h2 class="chapter-title">Chapter 7: ตรวจสอบตาข่ายความปลอดภัยของคุณ</h2>
                    <p class="chapter-subtitle">มาดูกันว่าตอนนี้คุณมีเครื่องมืออะไรที่ช่วยป้องกันความเสี่ยงอยู่บ้าง</p>
                    <div class="question-group">
                         <label class="form-label">1. ปัจจุบันคุณมีสวัสดิการหรือประกันอะไรบ้าง?</label>
                         <div class="icon-checkbox-group">
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ประกันสังคม" id="cc1"><label class="form-check-label" for="cc1"><i class="fas fa-landmark icon"></i>ประกันสังคม</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ประกันสุขภาพกลุ่ม" id="cc2"><label class="form-check-label" for="cc2"><i class="fas fa-building icon"></i>ประกันสุขภาพกลุ่มของบริษัท</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ประกันสุขภาพส่วนตัว" id="cc3"><label class="form-check-label" for="cc3"><i class="fas fa-user-shield icon"></i>ประกันสุขภาพส่วนตัว</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ประกันชีวิต" id="cc4"><label class="form-check-label" for="cc4"><i class="fas fa-file-contract icon"></i>ประกันชีวิต</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ประกันโรคร้ายแรง" id="cc5"><label class="form-check-label" for="cc5"><i class="fas fa-heart-pulse icon"></i>ประกันโรคร้ายแรง</label></div>
                             <div class="form-check"><input class="form-check-input" type="checkbox" name="current_coverage" value="ยังไม่มีเลย" id="cc6"><label class="form-check-label" for="cc6"><i class="fas fa-times-circle icon"></i>ยังไม่มีเลย</label></div>
                         </div>
                    </div>
                     <div class="question-group">
                         <label for="self_review" class="form-label">2. (คำถามสุดท้าย) เมื่อเทียบกับเป้าหมายและความกังวลทั้งหมด คุณคิดว่า "ตาข่ายความปลอดภัย" ที่มีอยู่ตอนนี้แข็งแรงพอหรือยัง?</label>
                         <textarea class="form-control" name="self_review" id="self_review" rows="3" placeholder="เช่น 'คิดว่ายังขาดเรื่องค่ารักษาพยาบาล' หรือ 'กังวลว่าเงินเกษียณจะไม่พอ'..."></textarea>
                     </div>
                </div>

                <!-- Final Result Screen (Chapter 9) (MOVED HERE) -->
                <div id="chapter-9" class="survey-chapter" data-name="พิมพ์เขียวฉบับสมบูรณ์">
                    <div id="final-blueprint-container">
                         <div id="final-loading-spinner">
                             <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                                 <span class="visually-hidden">Loading...</span>
                             </div>
                             <p class="mt-3">กำลังวิเคราะห์ข้อมูลเชิงลึกและจัดทำพิมพ์เขียวฉบับสมบูรณ์...</p>
                         </div>
                        <div id="final-gemini-report" class="d-none gemini-report">
                            <!-- Final Gemini AI Report will be injected here -->
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div id="navigation-wrapper" class="navigation-footer d-flex justify-content-between align-items-center">
                    <button id="prevButton" type="button" class="btn btn-custom btn-prev"><i class="fas fa-arrow-left me-2"></i>ย้อนกลับ</button>
                    <button id="nextButton" type="button" class="btn btn-custom btn-next">ถัดไป<i class="fas fa-arrow-right ms-2"></i></button>
                    <button id="submitButton" type="submit" class="btn btn-custom btn-next d-none">สร้างพิมพ์เขียวฉบับสมบูรณ์!</button>
                </div>
            </form>

            <!-- Final CTA Section (Can be shown at two points) -->
            <div id="final-cta-section" class="d-none p-4">
                 <h4 class="text-center">ก้าวต่อไปบนเส้นทางของคุณ</h4>
                 <p class="text-muted text-center">เลือกเส้นทางที่เหมาะกับคุณเพื่อทำให้พิมพ์เขียวนี้เป็นจริง</p>
                <a href="javascript:void(0)" id="cta-download" class="btn cta-btn d-flex align-items-center"><i class="fas fa-file-pdf fa-2x me-3 text-danger"></i><div><div class="cta-title">ดาวน์โหลดพิมพ์เขียว (PDF)</div><div class="cta-desc">เก็บสรุปแผนของคุณไว้พิจารณา (ฟังก์ชันเร็วๆ นี้)</div></div></a>
                <a href="https://line.me/ti/p/yg4Aoo_5LK" id="cta-line" class="btn cta-btn d-flex align-items-center" target="_blank"><i class="fab fa-line fa-2x me-3" style="color: #00B900;"></i><div><div class="cta-title">ปรึกษาเบื้องต้นผ่าน LINE</div><div class="cta-desc">สอบถามข้อสงสัยเพิ่มเติมกับที่ปรึกษา</div></div></a>
                <a href="https://calendly.com/first14102539" id="cta-calendly" class="btn cta-btn d-flex align-items-center" target="_blank"><i class="fas fa-calendar-check fa-2x me-3 text-primary"></i><div><div class="cta-title">นัดเวลาคุยกับที่ปรึกษา</div><div class="cta-desc">วางแผนอย่างจริงจัง (15 นาที ไม่มีค่าใช้จ่าย)</div></div></a>
            </div>
        </div>
    </div>
    
    <!-- Drag and Drop Library -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        const GOOGLE_APPS_SCRIPT_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE'; // <-- IMPORTANT: REPLACE THIS

        // --- CHAPTER DEFINITIONS ---
        const WELCOME_CHAPTER = 0;
        const PART_1_START_CHAPTER = 1;
        const PART_1_END_CHAPTER = 4;
        const INITIAL_REPORT_CHAPTER = 5;
        const PART_2_START_CHAPTER = 6;
        const PART_2_END_CHAPTER = 8;
        const FINAL_REPORT_CHAPTER = 9;

        let currentChapter = WELCOME_CHAPTER;
        const chapters = document.querySelectorAll('.survey-chapter');
        const form = document.getElementById('surveyForm');
        
        // --- BUTTONS ---
        const startButton = document.getElementById('startButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const submitButton = document.getElementById('submitButton');
        const continueButton = document.getElementById('continueButton');
        const stopButton = document.getElementById('stopButton');

        // --- UI ELEMENTS ---
        const progressWrapper = document.getElementById('progress-wrapper');
        const navigationWrapper = document.getElementById('navigation-wrapper');
        const progressBar = document.getElementById('progressBar');
        const chapterName = document.getElementById('chapterName');
        const chapterCounter = document.getElementById('chapterCounter');
        
        const loadingSpinner = document.getElementById('loading-spinner');
        const geminiReport = document.getElementById('gemini-report');
        const deepDiveCta = document.getElementById('deep-dive-cta');

        const finalLoadingSpinner = document.getElementById('final-loading-spinner');
        const finalGeminiReport = document.getElementById('final-gemini-report');
        const finalCtaSection = document.getElementById('final-cta-section');
        
        // --- SLIDER VALUE DISPLAYS ---
        const wlbSlider = document.getElementById('work_life_balance');
        const wlbValueDisplay = document.getElementById('wlb-value-display');
        const efSlider = document.getElementById('emergency_fund');
        const efValueDisplay = document.getElementById('ef-value-display');
        
        let formDataPart1 = {};
        
        // --- INITIALIZE SORTABLEJS ---
        const sortableList = document.getElementById('sortable-priorities');
        if (sortableList) {
            new Sortable(sortableList, { animation: 150, ghostClass: 'bg-light' });
        }

        // --- CORE FUNCTIONS ---

        function updateUI() {
            chapters.forEach((chapter, index) => chapter.classList.toggle('active', index === currentChapter));
            
            const totalFormChapters = 7; // 4 from part 1, 3 from part 2
            const isSurveyChapter = (currentChapter >= PART_1_START_CHAPTER && currentChapter <= PART_1_END_CHAPTER) || (currentChapter >= PART_2_START_CHAPTER && currentChapter <= PART_2_END_CHAPTER);

            if (isSurveyChapter) {
                progressWrapper.classList.remove('d-none');
                navigationWrapper.classList.add('d-none');
                navigationWrapper.classList.remove('d-flex');
                
                // Show navigation only for form chapters
                setTimeout(() => {
                    navigationWrapper.classList.remove('d-none');
                    navigationWrapper.classList.add('d-flex');
                }, 100);

                const activeChapterElement = chapters[currentChapter];
                const part1ChaptersCompleted = 4;
                const currentProgressStep = (currentChapter <= PART_1_END_CHAPTER) ? currentChapter : (part1ChaptersCompleted + (currentChapter - PART_2_START_CHAPTER) + 1);
                
                const progress = ((currentProgressStep) / totalFormChapters) * 100;
                
                progressBar.style.width = `${progress}%`;
                chapterName.textContent = activeChapterElement.dataset.name;
                chapterCounter.textContent = `ขั้นตอนที่ ${currentProgressStep} จาก ${totalFormChapters}`;
                
                const isFirstChapter = currentChapter === PART_1_START_CHAPTER;
                const isPart1End = currentChapter === PART_1_END_CHAPTER;
                const isPart2End = currentChapter === PART_2_END_CHAPTER;

                prevButton.classList.toggle('d-none', isFirstChapter);
                
                // Button visibility logic
                nextButton.classList.remove('d-none');
                submitButton.classList.add('d-none');
                
                if (isPart1End) {
                    nextButton.innerHTML = 'สร้างรายงานฉบับร่าง <i class="fas fa-arrow-right ms-2"></i>';
                } else if (isPart2End) {
                    nextButton.classList.add('d-none');
                    submitButton.classList.remove('d-none');
                } else {
                    nextButton.innerHTML = 'ถัดไป <i class="fas fa-arrow-right ms-2"></i>';
                }

                navigationWrapper.style.justifyContent = isFirstChapter ? 'flex-end' : 'space-between';
            } else {
                progressWrapper.classList.add('d-none');
                navigationWrapper.classList.add('d-none');
                navigationWrapper.classList.remove('d-flex');
            }
        }
        
        function navigateTo(chapterIndex) {
            currentChapter = chapterIndex;
            updateUI();
            window.scrollTo(0, 0);
        }

        function validateChapter(chapterIndex) {
            const chapter = chapters[chapterIndex];
            if (!chapter) return false;
            
            const questionGroups = chapter.querySelectorAll('.question-group');
            let isAllValid = true;

            questionGroups.forEach(group => {
                const inputs = group.querySelectorAll('input[required], textarea[required], select[required]');
                if (inputs.length === 0) return;

                let isGroupValid = false;
                const input = inputs[0]; // Assume one required question type per group for simplicity

                if (input.type === 'radio') {
                    const radioGroup = group.querySelectorAll(`input[name="${input.name}"]`);
                    isGroupValid = Array.from(radioGroup).some(r => r.checked);
                } else if (input.type === 'checkbox') {
                    const checkboxGroup = group.querySelectorAll(`input[name="${input.name}"]`);
                    isGroupValid = Array.from(checkboxGroup).some(cb => cb.checked);
                } else {
                    isGroupValid = input.value.trim() !== '';
                }

                group.classList.remove('invalid');
                if (!isGroupValid) {
                    group.classList.add('invalid');
                    setTimeout(() => group.classList.remove('invalid'), 600);
                    isAllValid = false;
                }
            });
            return isAllValid;
        }
        
        function getFormData(start, end) {
            const data = {};
            for (let i = start; i <= end; i++) {
                const chapter = chapters[i];
                if (!chapter) continue;
                const inputs = chapter.querySelectorAll('input, textarea, select');
                inputs.forEach(input => {
                     const name = input.name;
                     if (!name) return;
                     if (input.type === 'radio') {
                         if (input.checked) data[name] = input.value;
                     } else if (input.type === 'checkbox') {
                         if (!data[name]) data[name] = [];
                         if (input.checked) data[name].push(input.value);
                     } else if (input.type === 'hidden' && name === 'priorities_order') {
                         const items = Array.from(sortableList.getElementsByTagName('li'));
                         data[name] = items.map(item => item.textContent.trim());
                     } else if(input.value) {
                         data[name] = input.value;
                     }
                });
            }
            return data;
        }
        
        async function fetchReport(payload) {
            if (!GOOGLE_APPS_SCRIPT_URL || GOOGLE_APPS_SCRIPT_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                throw new Error("กรุณาตั้งค่า GOOGLE_APPS_SCRIPT_URL ในไฟล์ index.html");
            }
            const response = await fetch(GOOGLE_APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', // Use no-cors for cross-origin requests to Apps Script
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload),
                redirect: 'follow'
            });
            
            // Note: with no-cors, we can't inspect the response, so we optimistically parse it.
            // For proper error handling, deploy Apps Script correctly to handle CORS.
            const resultText = await response.text();
            try {
                const result = JSON.parse(resultText);
                if (result.result === 'success' && result.report) {
                    return result.report;
                } else {
                   throw new Error(result.message || 'Could not generate report from server.');
                }
            } catch (e) {
                 // If parsing fails, it might be a network error or an opaque response.
                 // We will return a generic error. For debugging, check Apps Script logs.
                 console.error("Failed to parse response:", resultText);
                 throw new Error("เกิดข้อผิดพลาดในการสื่อสารกับเซิร์ฟเวอร์ กรุณาตรวจสอบ Log ใน Apps Script");
            }
        }

        async function submitPart1() {
            navigateTo(INITIAL_REPORT_CHAPTER);
            formDataPart1 = getFormData(PART_1_START_CHAPTER, PART_1_END_CHAPTER);
            try {
                const payload = {
                    action: 'generateReport',
                    data: { ...formDataPart1, _formPart: 'part1' }
                };
                // For demo/testing without a live URL, uncomment below
                // const report = "<h3>รายงานฉบับร่าง (ตัวอย่าง)</h3><p>นี่คือตัวอย่างรายงานที่สร้างขึ้นโดยไม่มีการเชื่อมต่อเซิร์ฟเวอร์</p>";
                const report = await fetchReport(payload);
                geminiReport.innerHTML = report;
                loadingSpinner.classList.add('d-none');
                geminiReport.classList.remove('d-none');
                deepDiveCta.classList.remove('d-none');
            } catch (err) {
                 loadingSpinner.innerHTML = `<div class="text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i><p class="mt-2">ขออภัย, เกิดข้อผิดพลาด</p><small>${err.message}</small></div>`;
            }
        }

        async function submitFinal() {
            navigateTo(FINAL_REPORT_CHAPTER);
            const formDataPart2 = getFormData(PART_2_START_CHAPTER, PART_2_END_CHAPTER);
            const finalData = { ...formDataPart1, ...formDataPart2, _formPart: 'part2' };
            try {
                const payload = {
                    action: 'generateReport',
                    data: finalData
                };
                const report = await fetchReport(payload);
                finalGeminiReport.innerHTML = report;
                finalLoadingSpinner.classList.add('d-none');
                finalGeminiReport.classList.remove('d-none');
                finalCtaSection.classList.remove('d-none');
            } catch (err) {
                finalLoadingSpinner.innerHTML = `<div class="text-danger"><i class="fas fa-exclamation-triangle fa-2x"></i><p class="mt-2">ขออภัย, เกิดข้อผิดพลาด</p><small>${err.message}</small></div>`;
            }
        }

        // --- EVENT LISTENERS ---
        startButton.addEventListener('click', () => navigateTo(PART_1_START_CHAPTER));
        
        prevButton.addEventListener('click', () => {
            if (currentChapter > WELCOME_CHAPTER) {
                if (currentChapter === PART_2_START_CHAPTER) {
                    navigateTo(INITIAL_REPORT_CHAPTER);
                } else {
                    navigateTo(currentChapter - 1);
                }
            }
        });
        
        nextButton.addEventListener('click', () => {
            if (validateChapter(currentChapter)) {
                if (currentChapter === PART_1_END_CHAPTER) {
                    submitPart1();
                } else {
                    navigateTo(currentChapter + 1);
                }
            }
        });
        
        form.addEventListener('submit', (event) => {
            event.preventDefault();
            if (validateChapter(currentChapter)) {
                submitFinal();
            }
        });
        
        continueButton.addEventListener('click', () => navigateTo(PART_2_START_CHAPTER));
        
        stopButton.addEventListener('click', () => {
             deepDiveCta.classList.add('d-none');
             finalCtaSection.classList.remove('d-none');
        });
        
        // --- DYNAMIC LISTENERS ---
        const dependentsCheckboxes = document.querySelectorAll('input[name="dependents"]');
        const noDependentsCheckbox = document.getElementById('dep5');
        
        dependentsCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', (e) => {
                const hasChildrenCheckbox = document.getElementById('dep3');
                const childrenQuestions = document.getElementById('children_questions');

                if (e.target === noDependentsCheckbox && noDependentsCheckbox.checked) {
                    // If "no dependents" is checked, uncheck all others
                    dependentsCheckboxes.forEach(cb => {
                        if (cb !== noDependentsCheckbox) cb.checked = false;
                    });
                } else if (e.target !== noDependentsCheckbox && e.target.checked) {
                    // If any other is checked, uncheck "no dependents"
                    noDependentsCheckbox.checked = false;
                }
                
                // Toggle children questions visibility
                childrenQuestions.classList.toggle('d-none', !hasChildrenCheckbox.checked);
            });
        });
        
        const noFamilyHistoryCheckbox = document.getElementById('fh1');
        const familyHistoryCheckboxes = document.querySelectorAll('input[name="family_history"]');
        familyHistoryCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', e => {
                if (e.target === noFamilyHistoryCheckbox && noFamilyHistoryCheckbox.checked) {
                     familyHistoryCheckboxes.forEach(cb => {
                        if (cb !== noFamilyHistoryCheckbox) cb.checked = false;
                    });
                } else if (e.target !== noFamilyHistoryCheckbox && e.target.checked) {
                    noFamilyHistoryCheckbox.checked = false;
                }
            });
        });
        
        const noCoverageCheckbox = document.getElementById('cc6');
        const coverageCheckboxes = document.querySelectorAll('input[name="current_coverage"]');
        coverageCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', e => {
                if (e.target === noCoverageCheckbox && noCoverageCheckbox.checked) {
                     coverageCheckboxes.forEach(cb => {
                        if (cb !== noCoverageCheckbox) cb.checked = false;
                    });
                } else if (e.target !== noCoverageCheckbox && e.target.checked) {
                    noCoverageCheckbox.checked = false;
                }
            });
        });
        
        wlbSlider.addEventListener('input', () => { wlbValueDisplay.textContent = wlbSlider.value; });
        efSlider.addEventListener('input', () => { efValueDisplay.textContent = efSlider.value; });
        
        // Initial setup
        updateUI();
    });
    </script>
</body>
</html>

